"use strict";(self.webpackChunkfilebridge_docs=self.webpackChunkfilebridge_docs||[]).push([[54],{7610(e,n,i){i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"Docker-Deployment","title":"Docker Deployment","description":"FileBridge is configured for Next.js standalone output, producing a self-contained build that includes only the files needed to run \u2014 no node_modules required at runtime.","source":"@site/../docs/Docker-Deployment.md","sourceDirName":".","slug":"/Docker-Deployment","permalink":"/FileBridge/docs/Docker-Deployment","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Server Install","permalink":"/FileBridge/docs/Server-Install"},"next":{"title":"Configuration","permalink":"/FileBridge/docs/Configuration"}}');var l=i(4848),t=i(8453);const d={},s="Docker Deployment",a={},o=[{value:"Dockerfile",id:"dockerfile",level:2},{value:"Docker Compose",id:"docker-compose",level:2},{value:"Minimal",id:"minimal",level:3},{value:"With Explicit Env Vars",id:"with-explicit-env-vars",level:3},{value:"Environment File for Production",id:"environment-file-for-production",level:2},{value:"First-Run Setup",id:"first-run-setup",level:2},{value:"Build and Run",id:"build-and-run",level:2},{value:"Using the Pre-built Image (Recommended)",id:"using-the-pre-built-image-recommended",level:3},{value:"Building Locally",id:"building-locally",level:3},{value:"Volume Mounts",id:"volume-mounts",level:2},{value:"Separate Backup Volume (Recommended)",id:"separate-backup-volume-recommended",level:3},{value:"Reverse Proxy",id:"reverse-proxy",level:2},{value:"nginx Example",id:"nginx-example",level:3},{value:"Caddy Example",id:"caddy-example",level:3},{value:"Resource Requirements",id:"resource-requirements",level:2},{value:"Updating",id:"updating",level:2},{value:"Using the Pre-built Image",id:"using-the-pre-built-image",level:3},{value:"Building Locally",id:"building-locally-1",level:3},{value:"Multi-Stage Build Notes",id:"multi-stage-build-notes",level:2},{value:"Important: NODE_OPTIONS",id:"important-node_options",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"docker-deployment",children:"Docker Deployment"})}),"\n",(0,l.jsxs)(n.p,{children:["FileBridge is configured for Next.js ",(0,l.jsx)(n.strong,{children:"standalone output"}),", producing a self-contained build that includes only the files needed to run \u2014 no ",(0,l.jsx)(n.code,{children:"node_modules"})," required at runtime."]}),"\n",(0,l.jsx)(n.p,{children:"Pre-built images are published to the GitHub Container Registry on every release:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker pull ghcr.io/go2engle/filebridge:latest\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Available tags: ",(0,l.jsx)(n.code,{children:"latest"}),", ",(0,l.jsx)(n.code,{children:"1"}),", ",(0,l.jsx)(n.code,{children:"1.x"}),", ",(0,l.jsx)(n.code,{children:"1.x.y"})," (semantic versioning)."]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"dockerfile",children:"Dockerfile"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-dockerfile",children:'FROM node:20-alpine AS builder\nWORKDIR /app\n\nCOPY package*.json ./\nRUN npm ci\n\nCOPY . .\nRUN npm run build\n\n# \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nFROM node:20-alpine AS runner\nWORKDIR /app\n\nENV NODE_ENV=production\n# Required for SMB/CIFS NTLMv2 support (MD4 hash via OpenSSL legacy provider)\nENV NODE_OPTIONS=--openssl-legacy-provider\n\n# Copy standalone build output\nCOPY --from=builder /app/.next/standalone ./\nCOPY --from=builder /app/.next/static ./.next/static\nCOPY --from=builder /app/public ./public\n\n# Create the data directory for SQLite\nRUN mkdir -p data\n\nEXPOSE 3000\n\nCMD ["node", "server.js"]\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"docker-compose",children:"Docker Compose"}),"\n",(0,l.jsx)(n.h3,{id:"minimal",children:"Minimal"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'version: "3.8"\n\nservices:\n  filebridge:\n    build: .\n    ports:\n      - "3000:3000"\n    volumes:\n      - filebridge-data:/app/data\n    environment:\n      - NODE_OPTIONS=--openssl-legacy-provider\n    env_file:\n      - .env.production\n\nvolumes:\n  filebridge-data:\n'})}),"\n",(0,l.jsx)(n.h3,{id:"with-explicit-env-vars",children:"With Explicit Env Vars"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'version: "3.8"\n\nservices:\n  filebridge:\n    image: ghcr.io/go2engle/filebridge:latest\n    ports:\n      - "3000:3000"\n    volumes:\n      - filebridge-data:/app/data\n    environment:\n      NODE_OPTIONS: "--openssl-legacy-provider"\n      NODE_ENV: "production"\n      AUTH_SECRET: "${AUTH_SECRET}"\n      NEXTAUTH_URL: "https://filebridge.example.com"\n      DATABASE_PATH: "/app/data/filebridge.db"\n      LOG_LEVEL: "info"\n    healthcheck:\n      test: ["CMD", "wget", "-q", "-O", "-", "http://localhost:3000/api/health"]\n      interval: 30s\n      timeout: 5s\n      retries: 3\n      start_period: 15s\n    restart: unless-stopped\n\nvolumes:\n  filebridge-data:\n    driver: local\n'})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Note"}),": SSO providers (Azure AD, GitHub) are configured through the admin UI after first-run setup \u2014 no SSO-related environment variables are needed in the container."]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"environment-file-for-production",children:"Environment File for Production"}),"\n",(0,l.jsxs)(n.p,{children:["Create a ",(0,l.jsx)(n.code,{children:".env.production"})," file (never commit this to git):"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-env",children:"AUTH_SECRET=<openssl rand -base64 32>\nNEXTAUTH_URL=https://filebridge.example.com\n\nDATABASE_PATH=/app/data/filebridge.db\nLOG_LEVEL=info\n"})}),"\n",(0,l.jsx)(n.p,{children:"That's it. On first launch, the setup wizard will create your admin account. SSO providers can be configured later through the admin UI."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"first-run-setup",children:"First-Run Setup"}),"\n",(0,l.jsx)(n.p,{children:"When the container starts for the first time:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["The SQLite database is automatically created at the ",(0,l.jsx)(n.code,{children:"DATABASE_PATH"})," location"]}),"\n",(0,l.jsxs)(n.li,{children:["FileBridge detects no users exist and redirects to the ",(0,l.jsx)(n.strong,{children:"Setup Wizard"})]}),"\n",(0,l.jsx)(n.li,{children:"Create your initial administrator account through the wizard"}),"\n",(0,l.jsx)(n.li,{children:"Sign in and start configuring connections, jobs, and (optionally) SSO providers"}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"build-and-run",children:"Build and Run"}),"\n",(0,l.jsx)(n.h3,{id:"using-the-pre-built-image-recommended",children:"Using the Pre-built Image (Recommended)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Pull from GitHub Container Registry\ndocker pull ghcr.io/go2engle/filebridge:latest\n\n# Run with env file\ndocker run -d \\\n  --name filebridge \\\n  -p 3000:3000 \\\n  -v filebridge-data:/app/data \\\n  --env-file .env.production \\\n  --restart unless-stopped \\\n  ghcr.io/go2engle/filebridge:latest\n\n# View logs\ndocker logs -f filebridge\n\n# Health check\ncurl http://localhost:3000/api/health\n"})}),"\n",(0,l.jsx)(n.h3,{id:"building-locally",children:"Building Locally"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Build the image\ndocker build -t filebridge:latest .\n\n# Run with env file\ndocker run -d \\\n  --name filebridge \\\n  -p 3000:3000 \\\n  -v filebridge-data:/app/data \\\n  --env-file .env.production \\\n  --restart unless-stopped \\\n  filebridge:latest\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"volume-mounts",children:"Volume Mounts"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Path"}),(0,l.jsx)(n.th,{children:"Purpose"})]})}),(0,l.jsx)(n.tbody,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"/app/data"})}),(0,l.jsxs)(n.td,{children:["SQLite database (",(0,l.jsx)(n.code,{children:"filebridge.db"}),") and backup files"]})]})})]}),"\n",(0,l.jsxs)(n.p,{children:["Mount this volume to a persistent storage location. If the volume is lost, all jobs, connections, users, settings, and logs are lost. Use the ",(0,l.jsx)(n.a,{href:"Database-Backups",children:"backup system"})," to protect against this."]}),"\n",(0,l.jsx)(n.h3,{id:"separate-backup-volume-recommended",children:"Separate Backup Volume (Recommended)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"volumes:\n  - filebridge-db:/app/data          # Database file only\n  - filebridge-backups:/app/backups  # Backup files on separate storage\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Then configure the backup path in ",(0,l.jsx)(n.strong,{children:"Settings \u2192 Database Backups"})," to ",(0,l.jsx)(n.code,{children:"/app/backups"}),"."]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"reverse-proxy",children:"Reverse Proxy"}),"\n",(0,l.jsx)(n.p,{children:"FileBridge should run behind a reverse proxy (nginx, Caddy, Traefik) for TLS termination in production."}),"\n",(0,l.jsx)(n.h3,{id:"nginx-example",children:"nginx Example"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-nginx",children:"server {\n    listen 443 ssl http2;\n    server_name filebridge.example.com;\n\n    ssl_certificate     /etc/ssl/certs/filebridge.crt;\n    ssl_certificate_key /etc/ssl/private/filebridge.key;\n\n    location / {\n        proxy_pass         http://localhost:3000;\n        proxy_http_version 1.1;\n        proxy_set_header   Upgrade $http_upgrade;\n        proxy_set_header   Connection 'upgrade';\n        proxy_set_header   Host $host;\n        proxy_set_header   X-Real-IP $remote_addr;\n        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header   X-Forwarded-Proto $scheme;\n        proxy_cache_bypass $http_upgrade;\n    }\n}\n\nserver {\n    listen 80;\n    server_name filebridge.example.com;\n    return 301 https://$host$request_uri;\n}\n"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Important"}),": Pass ",(0,l.jsx)(n.code,{children:"X-Forwarded-For"})," and ",(0,l.jsx)(n.code,{children:"X-Real-IP"})," headers so FileBridge can log accurate client IP addresses in the audit trail."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"caddy-example",children:"Caddy Example"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-caddyfile",children:"filebridge.example.com {\n    reverse_proxy localhost:3000\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:"Caddy handles TLS automatically via Let's Encrypt."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"resource-requirements",children:"Resource Requirements"}),"\n",(0,l.jsx)(n.p,{children:"FileBridge is lightweight. Typical resource usage:"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Resource"}),(0,l.jsx)(n.th,{children:"Minimum"}),(0,l.jsx)(n.th,{children:"Recommended"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"CPU"}),(0,l.jsx)(n.td,{children:"0.25 vCPU"}),(0,l.jsx)(n.td,{children:"1 vCPU"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Memory"}),(0,l.jsx)(n.td,{children:"256 MB"}),(0,l.jsx)(n.td,{children:"512 MB"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Disk (app)"}),(0,l.jsx)(n.td,{children:"200 MB"}),(0,l.jsx)(n.td,{children:"200 MB"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Disk (data)"}),(0,l.jsx)(n.td,{children:"50 MB + logs"}),(0,l.jsx)(n.td,{children:"1\u20135 GB"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:"Memory usage spikes temporarily while files are in transit, as files are buffered in memory during download/upload. For large files (100MB+), size your container accordingly or use streaming transfers (planned feature)."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"updating",children:"Updating"}),"\n",(0,l.jsx)(n.h3,{id:"using-the-pre-built-image",children:"Using the Pre-built Image"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Pull the latest release\ndocker pull ghcr.io/go2engle/filebridge:latest\n\n# Recreate the container\ndocker stop filebridge\ndocker rm filebridge\ndocker run -d \\\n  --name filebridge \\\n  -p 3000:3000 \\\n  -v filebridge-data:/app/data \\\n  --env-file .env.production \\\n  --restart unless-stopped \\\n  ghcr.io/go2engle/filebridge:latest\n"})}),"\n",(0,l.jsx)(n.h3,{id:"building-locally-1",children:"Building Locally"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Pull latest code and rebuild\ngit pull\ndocker build -t filebridge:latest .\n\ndocker stop filebridge\ndocker rm filebridge\ndocker run -d \\\n  --name filebridge \\\n  -p 3000:3000 \\\n  -v filebridge-data:/app/data \\\n  --env-file .env.production \\\n  --restart unless-stopped \\\n  filebridge:latest\n"})}),"\n",(0,l.jsx)(n.p,{children:"The database schema auto-migrates on startup \u2014 no manual migration step is needed."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"multi-stage-build-notes",children:"Multi-Stage Build Notes"}),"\n",(0,l.jsx)(n.p,{children:"The Dockerfile uses a two-stage build:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Builder stage"}),": Installs all dependencies (including ",(0,l.jsx)(n.code,{children:"devDependencies"}),") and compiles the Next.js app"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Runner stage"}),": Copies only the standalone build output \u2014 no source code, no dev dependencies, no ",(0,l.jsx)(n.code,{children:"node_modules"})," (except those bundled by Next.js standalone)"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["The standalone output is produced by the ",(0,l.jsx)(n.code,{children:'output: "standalone"'})," setting in ",(0,l.jsx)(n.code,{children:"next.config.ts"}),"."]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"important-node_options",children:"Important: NODE_OPTIONS"}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"NODE_OPTIONS=--openssl-legacy-provider"})," environment variable ",(0,l.jsx)(n.strong,{children:"must"})," be set in the container for SMB/CIFS connections to work. NTLM authentication requires the MD4 hash algorithm, which was removed from OpenSSL 3.x (used by Node.js 17+). The legacy provider re-enables it."]}),"\n",(0,l.jsx)(n.p,{children:"Without this variable, all SMB operations will fail with a cryptographic error. SFTP and Azure Blob Storage are not affected."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},8453(e,n,i){i.d(n,{R:()=>d,x:()=>s});var r=i(6540);const l={},t=r.createContext(l);function d(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);