"use strict";(self.webpackChunkfilebridge_docs=self.webpackChunkfilebridge_docs||[]).push([[664],{4733(e,d,n){n.r(d),n.d(d,{assets:()=>c,contentTitle:()=>l,default:()=>a,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"Audit-Logging","title":"Audit Logging","description":"FileBridge maintains a detailed audit trail of all security-relevant actions. Every significant operation \u2014 creating or deleting connections, running jobs, changing settings, signing in \u2014 is recorded with the user identity, IP address, resource affected, and a structured details payload.","source":"@site/../docs/Audit-Logging.md","sourceDirName":".","slug":"/Audit-Logging","permalink":"/FileBridge/docs/Audit-Logging","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Health Check","permalink":"/FileBridge/docs/Health-Check"},"next":{"title":"Structured Logging","permalink":"/FileBridge/docs/Structured-Logging"}}');var s=n(4848),r=n(8453);const t={},l="Audit Logging",c={},o=[{value:"What Gets Logged",id:"what-gets-logged",level:2},{value:"Audit Log Fields",id:"audit-log-fields",level:2},{value:"Details Payload Examples",id:"details-payload-examples",level:2},{value:"Job Created",id:"job-created",level:3},{value:"Job Updated (with diff)",id:"job-updated-with-diff",level:3},{value:"Job Executed (Manual)",id:"job-executed-manual",level:3},{value:"Job Executed (Scheduled)",id:"job-executed-scheduled",level:3},{value:"Login (Successful)",id:"login-successful",level:3},{value:"Login (Denied)",id:"login-denied",level:3},{value:"Settings Changed",id:"settings-changed",level:3},{value:"Viewing the Audit Log",id:"viewing-the-audit-log",level:2},{value:"API",id:"api",level:2},{value:"<code>GET /api/audit-logs</code>",id:"get-apiaudit-logs",level:3},{value:"Database Indexes",id:"database-indexes",level:2},{value:"Implementation Details",id:"implementation-details",level:2},{value:"Correlation with Structured Logs",id:"correlation-with-structured-logs",level:2}];function h(e){const d={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.header,{children:(0,s.jsx)(d.h1,{id:"audit-logging",children:"Audit Logging"})}),"\n",(0,s.jsx)(d.p,{children:"FileBridge maintains a detailed audit trail of all security-relevant actions. Every significant operation \u2014 creating or deleting connections, running jobs, changing settings, signing in \u2014 is recorded with the user identity, IP address, resource affected, and a structured details payload."}),"\n",(0,s.jsx)(d.hr,{}),"\n",(0,s.jsx)(d.h2,{id:"what-gets-logged",children:"What Gets Logged"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"Action"}),(0,s.jsx)(d.th,{children:"Resource"}),(0,s.jsx)(d.th,{children:"When"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"create"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"connection"})}),(0,s.jsx)(d.td,{children:"New connection saved"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"update"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"connection"})}),(0,s.jsx)(d.td,{children:"Connection edited"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"delete"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"connection"})}),(0,s.jsx)(d.td,{children:"Connection deleted"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"create"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"job"})}),(0,s.jsx)(d.td,{children:"New job saved"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"update"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"job"})}),(0,s.jsx)(d.td,{children:"Job edited (includes field-level diff)"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"delete"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"job"})}),(0,s.jsx)(d.td,{children:"Job deleted"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"execute"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"job"})}),(0,s.jsx)(d.td,{children:"Job run triggered (manual or scheduled)"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"login"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"auth"})}),(0,s.jsx)(d.td,{children:"User sign-in attempt (success or denied)"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"settings_change"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"settings"})}),(0,s.jsx)(d.td,{children:"Notification settings saved"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"settings_change"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"settings"})}),(0,s.jsx)(d.td,{children:"Backup settings saved"})]})]})]}),"\n",(0,s.jsx)(d.hr,{}),"\n",(0,s.jsx)(d.h2,{id:"audit-log-fields",children:"Audit Log Fields"}),"\n",(0,s.jsx)(d.p,{children:"Each audit log record contains:"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"Field"}),(0,s.jsx)(d.th,{children:"Description"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"id"})}),(0,s.jsx)(d.td,{children:"Auto-increment primary key"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"userId"})}),(0,s.jsxs)(d.td,{children:["Email address of the user who performed the action (or ",(0,s.jsx)(d.code,{children:'"scheduler"'})," for scheduled runs)"]})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"action"})}),(0,s.jsxs)(d.td,{children:["One of: ",(0,s.jsx)(d.code,{children:"create"}),", ",(0,s.jsx)(d.code,{children:"update"}),", ",(0,s.jsx)(d.code,{children:"delete"}),", ",(0,s.jsx)(d.code,{children:"execute"}),", ",(0,s.jsx)(d.code,{children:"login"}),", ",(0,s.jsx)(d.code,{children:"settings_change"})]})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"resource"})}),(0,s.jsxs)(d.td,{children:["One of: ",(0,s.jsx)(d.code,{children:"connection"}),", ",(0,s.jsx)(d.code,{children:"job"}),", ",(0,s.jsx)(d.code,{children:"settings"}),", ",(0,s.jsx)(d.code,{children:"job_run"}),", ",(0,s.jsx)(d.code,{children:"auth"})]})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"resourceId"})}),(0,s.jsx)(d.td,{children:"Database ID of the affected record (nullable)"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"resourceName"})}),(0,s.jsx)(d.td,{children:"Human-readable name (e.g. job name, connection name)"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"ipAddress"})}),(0,s.jsxs)(d.td,{children:["Client IP address extracted from ",(0,s.jsx)(d.code,{children:"X-Forwarded-For"})," or ",(0,s.jsx)(d.code,{children:"X-Real-IP"})]})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"details"})}),(0,s.jsx)(d.td,{children:"JSON object with additional context (varies by action)"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"timestamp"})}),(0,s.jsx)(d.td,{children:"ISO 8601 timestamp of the event"})]})]})]}),"\n",(0,s.jsx)(d.hr,{}),"\n",(0,s.jsx)(d.h2,{id:"details-payload-examples",children:"Details Payload Examples"}),"\n",(0,s.jsx)(d.h3,{id:"job-created",children:"Job Created"}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-json",children:'{\n  "schedule": "0 6 * * *",\n  "status": "active",\n  "sourceConnectionId": 1,\n  "destinationConnectionId": 2\n}\n'})}),"\n",(0,s.jsx)(d.h3,{id:"job-updated-with-diff",children:"Job Updated (with diff)"}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-json",children:'{\n  "changes": {\n    "schedule": { "from": "0 6 * * *", "to": "0 8 * * 1-5" },\n    "fileFilter": { "from": "", "to": "*.csv" }\n  }\n}\n'})}),"\n",(0,s.jsxs)(d.p,{children:["The ",(0,s.jsx)(d.code,{children:"diffChanges"})," function computes a field-level diff between the old and new values. Sensitive fields (",(0,s.jsx)(d.code,{children:"credentials"}),", timestamps) are excluded from the diff."]}),"\n",(0,s.jsx)(d.h3,{id:"job-executed-manual",children:"Job Executed (Manual)"}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-json",children:'{\n  "trigger": "manual"\n}\n'})}),"\n",(0,s.jsx)(d.h3,{id:"job-executed-scheduled",children:"Job Executed (Scheduled)"}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-json",children:'{\n  "trigger": "scheduled",\n  "schedule": "0 6 * * *"\n}\n'})}),"\n",(0,s.jsx)(d.h3,{id:"login-successful",children:"Login (Successful)"}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-json",children:'{\n  "outcome": "success"\n}\n'})}),"\n",(0,s.jsx)(d.h3,{id:"login-denied",children:"Login (Denied)"}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-json",children:'{\n  "outcome": "denied"\n}\n'})}),"\n",(0,s.jsx)(d.h3,{id:"settings-changed",children:"Settings Changed"}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-json",children:'{\n  "key": "notifications",\n  "changes": {\n    "alertOnFailure": { "from": false, "to": true }\n  }\n}\n'})}),"\n",(0,s.jsx)(d.hr,{}),"\n",(0,s.jsx)(d.h2,{id:"viewing-the-audit-log",children:"Viewing the Audit Log"}),"\n",(0,s.jsxs)(d.p,{children:["Navigate to ",(0,s.jsx)(d.strong,{children:"Audit Log"})," in the sidebar (shield icon). The audit log UI provides:"]}),"\n",(0,s.jsxs)(d.ul,{children:["\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.strong,{children:"Paginated table"})," with all audit events"]}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.strong,{children:"Action badges"})," color-coded by type (create = green, delete = red, execute = blue, etc.)"]}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.strong,{children:"Details tooltip"})," \u2014 hover over a row to see the full JSON details payload"]}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.strong,{children:"Filter by user"})," \u2014 show only actions by a specific user"]}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.strong,{children:"Filter by action"})," \u2014 narrow to creates, deletes, logins, etc."]}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.strong,{children:"Filter by resource"})," \u2014 show only job events, connection events, etc."]}),"\n"]}),"\n",(0,s.jsx)(d.hr,{}),"\n",(0,s.jsx)(d.h2,{id:"api",children:"API"}),"\n",(0,s.jsx)(d.h3,{id:"get-apiaudit-logs",children:(0,s.jsx)(d.code,{children:"GET /api/audit-logs"})}),"\n",(0,s.jsxs)(d.p,{children:["See ",(0,s.jsx)(d.a,{href:"API-Reference#audit-logs",children:"API Reference"})," for the full query parameter and response documentation."]}),"\n",(0,s.jsx)(d.hr,{}),"\n",(0,s.jsx)(d.h2,{id:"database-indexes",children:"Database Indexes"}),"\n",(0,s.jsxs)(d.p,{children:["The ",(0,s.jsx)(d.code,{children:"audit_logs"})," table has indexes on:"]}),"\n",(0,s.jsxs)(d.ul,{children:["\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.code,{children:"timestamp"})," \u2014 for time-range queries"]}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.code,{children:"user_id"})," \u2014 for per-user filtering"]}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.code,{children:"resource"})," \u2014 for resource-type filtering"]}),"\n"]}),"\n",(0,s.jsx)(d.hr,{}),"\n",(0,s.jsx)(d.h2,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,s.jsxs)(d.p,{children:["Audit logging is implemented in ",(0,s.jsx)(d.code,{children:"lib/audit.ts"}),". The ",(0,s.jsx)(d.code,{children:"logAudit()"})," function is ",(0,s.jsx)(d.strong,{children:"fire-and-forget"})," \u2014 errors writing to the audit table are caught and logged to the structured logger but never interrupt the calling request. This ensures an audit table write failure does not block a user operation."]}),"\n",(0,s.jsx)(d.p,{children:"The IP address is extracted in order of preference:"}),"\n",(0,s.jsxs)(d.ol,{children:["\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.code,{children:"X-Forwarded-For"})," (first value, for reverse proxy scenarios)"]}),"\n",(0,s.jsx)(d.li,{children:(0,s.jsx)(d.code,{children:"X-Real-IP"})}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.code,{children:"null"})," if neither header is present"]}),"\n"]}),"\n",(0,s.jsx)(d.hr,{}),"\n",(0,s.jsx)(d.h2,{id:"correlation-with-structured-logs",children:"Correlation with Structured Logs"}),"\n",(0,s.jsxs)(d.p,{children:["Audit log entries work alongside the structured log output. The ",(0,s.jsx)(d.code,{children:"X-Request-ID"})," header (set by middleware) appears in structured log lines for the same request, allowing you to correlate:"]}),"\n",(0,s.jsxs)(d.ul,{children:["\n",(0,s.jsx)(d.li,{children:"The audit log entry (who did what, to what)"}),"\n",(0,s.jsx)(d.li,{children:"The structured log lines (what actually happened during execution)"}),"\n"]}),"\n",(0,s.jsxs)(d.p,{children:["For example, a ",(0,s.jsx)(d.code,{children:"POST /api/jobs/7/run"})," request produces:"]}),"\n",(0,s.jsxs)(d.ol,{children:["\n",(0,s.jsxs)(d.li,{children:["An audit log entry: ",(0,s.jsx)(d.code,{children:'{ action: "execute", resource: "job", resourceId: 7 }'})]}),"\n",(0,s.jsxs)(d.li,{children:["A series of structured log lines tagged with ",(0,s.jsx)(d.code,{children:'{ requestId: "uuid", jobId: 7, runId: 42 }'})]}),"\n"]})]})}function a(e={}){const{wrapper:d}={...(0,r.R)(),...e.components};return d?(0,s.jsx)(d,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453(e,d,n){n.d(d,{R:()=>t,x:()=>l});var i=n(6540);const s={},r=i.createContext(s);function t(e){const d=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(d):{...d,...e}},[d,e])}function l(e){let d;return d=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(r.Provider,{value:d},e.children)}}}]);