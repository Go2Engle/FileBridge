"use strict";(self.webpackChunkfilebridge_docs=self.webpackChunkfilebridge_docs||[]).push([[642],{7445(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"Authentication","title":"Authentication","description":"FileBridge uses NextAuth v5 (Auth.js) with support for local username/password authentication and optional external SSO providers (Azure AD, GitHub). Authentication protects every page and API route. A two-tier role system (Administrator and Viewer) controls what authenticated users can do.","source":"@site/../docs/Authentication.md","sourceDirName":".","slug":"/Authentication","permalink":"/FileBridge/docs/Authentication","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Configuration","permalink":"/FileBridge/docs/Configuration"},"next":{"title":"Connections","permalink":"/FileBridge/docs/Connections"}}');var r=s(4848),t=s(8453);const l={},d="Authentication",o={},c=[{value:"How It Works",id:"how-it-works",level:2},{value:"First-Run Setup Wizard",id:"first-run-setup-wizard",level:2},{value:"Local Authentication",id:"local-authentication",level:2},{value:"SSO Providers",id:"sso-providers",level:2},{value:"Configuring SSO",id:"configuring-sso",level:3},{value:"Azure AD Setup",id:"azure-ad-setup",level:3},{value:"GitHub Setup",id:"github-setup",level:3},{value:"SSO User Provisioning",id:"sso-user-provisioning",level:3},{value:"Roles &amp; Permissions (RBAC)",id:"roles--permissions-rbac",level:2},{value:"How Roles Work",id:"how-roles-work",level:3},{value:"Role Enforcement",id:"role-enforcement",level:3},{value:"User Management",id:"user-management",level:2},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Login Audit Events",id:"login-audit-events",level:2},{value:"Dev Bypass Mode",id:"dev-bypass-mode",level:2},{value:"Session Management",id:"session-management",level:2},{value:"Proxy",id:"proxy",level:2}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"authentication",children:"Authentication"})}),"\n",(0,r.jsxs)(n.p,{children:["FileBridge uses ",(0,r.jsx)(n.strong,{children:"NextAuth v5"})," (Auth.js) with support for ",(0,r.jsx)(n.strong,{children:"local username/password authentication"})," and optional ",(0,r.jsx)(n.strong,{children:"external SSO providers"})," (Azure AD, GitHub). Authentication protects every page and API route. A two-tier role system (Administrator and Viewer) controls what authenticated users can do."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["On first launch, FileBridge detects an empty user database and redirects to the ",(0,r.jsx)(n.strong,{children:"Setup Wizard"})]}),"\n",(0,r.jsx)(n.li,{children:"The wizard creates the first local administrator account"}),"\n",(0,r.jsxs)(n.li,{children:["Subsequent users sign in via the ",(0,r.jsx)(n.strong,{children:"Login"})," page using their username and password"]}),"\n",(0,r.jsx)(n.li,{children:"If SSO providers are configured by an admin, SSO buttons appear on the login page"}),"\n",(0,r.jsxs)(n.li,{children:["Sessions are JWT-based and validated on every request via ",(0,r.jsx)(n.code,{children:"proxy.ts"})]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"first-run-setup-wizard",children:"First-Run Setup Wizard"}),"\n",(0,r.jsxs)(n.p,{children:["When no users exist in the database, FileBridge automatically redirects to ",(0,r.jsx)(n.code,{children:"/setup"}),". The wizard walks you through creating the initial administrator account:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Welcome"})," \u2014 overview of what the wizard configures"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Create Admin"})," \u2014 set a username, display name, optional email, and password"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Complete"})," \u2014 redirects to the login page"]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["The setup endpoint (",(0,r.jsx)(n.code,{children:"POST /api/setup"}),") is guarded by ",(0,r.jsx)(n.code,{children:"isFirstRun()"})," \u2014 it returns 403 if any users already exist. There is no way to re-run the wizard after the first user is created."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"local-authentication",children:"Local Authentication"}),"\n",(0,r.jsx)(n.p,{children:"FileBridge supports built-in username/password login:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Passwords are hashed with ",(0,r.jsx)(n.strong,{children:"bcrypt"})," (12 salt rounds) before storage"]}),"\n",(0,r.jsxs)(n.li,{children:["The Credentials provider in NextAuth validates login attempts against the ",(0,r.jsx)(n.code,{children:"users"})," table"]}),"\n",(0,r.jsx)(n.li,{children:'Failed login attempts show a generic "Invalid username or password" message (no user enumeration)'}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"sso-providers",children:"SSO Providers"}),"\n",(0,r.jsxs)(n.p,{children:["External SSO providers (Azure AD, GitHub) are configured entirely through the ",(0,r.jsx)(n.strong,{children:"Admin UI"})," \u2014 no environment variables needed."]}),"\n",(0,r.jsx)(n.h3,{id:"configuring-sso",children:"Configuring SSO"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Sign in as an administrator"}),"\n",(0,r.jsxs)(n.li,{children:["Navigate to ",(0,r.jsx)(n.strong,{children:"Admin \u2192 Authentication"})]}),"\n",(0,r.jsxs)(n.li,{children:["Click ",(0,r.jsx)(n.strong,{children:"Add Provider"})]}),"\n",(0,r.jsx)(n.li,{children:"Fill in the provider details (Client ID, Client Secret, Tenant ID for Azure AD)"}),"\n",(0,r.jsx)(n.li,{children:'Save \u2014 the provider\'s "Sign in with..." button immediately appears on the login page'}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"azure-ad-setup",children:"Azure AD Setup"}),"\n",(0,r.jsx)(n.p,{children:"To configure Azure AD as an SSO provider:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Go to the ",(0,r.jsx)(n.a,{href:"https://portal.azure.com",children:"Azure portal"})," \u2192 ",(0,r.jsx)(n.strong,{children:"Microsoft Entra ID"})," \u2192 ",(0,r.jsx)(n.strong,{children:"App registrations"})]}),"\n",(0,r.jsxs)(n.li,{children:["Click ",(0,r.jsx)(n.strong,{children:"New registration"})]}),"\n",(0,r.jsxs)(n.li,{children:["Set the ",(0,r.jsx)(n.strong,{children:"Name"}),' (e.g. "FileBridge")']}),"\n",(0,r.jsxs)(n.li,{children:["Set ",(0,r.jsx)(n.strong,{children:"Supported account types"}),' to "Accounts in this organizational directory only"']}),"\n",(0,r.jsxs)(n.li,{children:["Set the ",(0,r.jsx)(n.strong,{children:"Redirect URI"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Type: ",(0,r.jsx)(n.strong,{children:"Web"})]}),"\n",(0,r.jsxs)(n.li,{children:["URI: ",(0,r.jsx)(n.code,{children:"https://your-domain.com/api/auth/callback/azure-ad"})]}),"\n",(0,r.jsxs)(n.li,{children:["For local development: ",(0,r.jsx)(n.code,{children:"http://localhost:3000/api/auth/callback/azure-ad"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Click ",(0,r.jsx)(n.strong,{children:"Register"})]}),"\n",(0,r.jsxs)(n.li,{children:["Copy the ",(0,r.jsx)(n.strong,{children:"Application (client) ID"})," and ",(0,r.jsx)(n.strong,{children:"Directory (tenant) ID"})," from the Overview page"]}),"\n",(0,r.jsxs)(n.li,{children:["Create a ",(0,r.jsx)(n.strong,{children:"Client secret"})," under ",(0,r.jsx)(n.strong,{children:"Certificates & secrets"})]}),"\n",(0,r.jsxs)(n.li,{children:["Enter these values in FileBridge's ",(0,r.jsx)(n.strong,{children:"Admin \u2192 Authentication \u2192 Add Provider"})," form"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"github-setup",children:"GitHub Setup"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Go to ",(0,r.jsx)(n.a,{href:"https://github.com/settings/developers",children:"GitHub Developer Settings"})," \u2192 ",(0,r.jsx)(n.strong,{children:"OAuth Apps"})," \u2192 ",(0,r.jsx)(n.strong,{children:"New OAuth App"})]}),"\n",(0,r.jsxs)(n.li,{children:["Set the ",(0,r.jsx)(n.strong,{children:"Authorization callback URL"})," to ",(0,r.jsx)(n.code,{children:"https://your-domain.com/api/auth/callback/github"})]}),"\n",(0,r.jsxs)(n.li,{children:["Copy the ",(0,r.jsx)(n.strong,{children:"Client ID"})," and generate a ",(0,r.jsx)(n.strong,{children:"Client Secret"})]}),"\n",(0,r.jsxs)(n.li,{children:["Enter these values in FileBridge's ",(0,r.jsx)(n.strong,{children:"Admin \u2192 Authentication \u2192 Add Provider"})," form"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"sso-user-provisioning",children:"SSO User Provisioning"}),"\n",(0,r.jsxs)(n.p,{children:["SSO follows a ",(0,r.jsx)(n.strong,{children:"deny-by-default"})," model. An administrator must pre-create a user account in ",(0,r.jsx)(n.strong,{children:"Admin \u2192 Users"})," before that person can sign in via SSO:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Create the user with their email address and set ",(0,r.jsx)(n.strong,{children:"Auth Type"})," to SSO"]}),"\n",(0,r.jsx)(n.li,{children:"Select the appropriate SSO provider"}),"\n",(0,r.jsx)(n.li,{children:"When the user signs in via SSO, FileBridge matches them by SSO identity or email"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Users who are not pre-created in FileBridge will be denied access even if they authenticate successfully with the SSO provider."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"roles--permissions-rbac",children:"Roles & Permissions (RBAC)"}),"\n",(0,r.jsx)(n.p,{children:"FileBridge has two roles:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Role"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Administrator"})}),(0,r.jsx)(n.td,{children:"Full access \u2014 can create/edit/delete connections, jobs, users, and SSO settings"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Viewer"})}),(0,r.jsx)(n.td,{children:"Read-only access \u2014 can view connections, jobs, logs, and settings but cannot modify anything"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"how-roles-work",children:"How Roles Work"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Roles are stored in the ",(0,r.jsx)(n.code,{children:"users"})," table and stamped into the JWT token at login"]}),"\n",(0,r.jsxs)(n.li,{children:["API routes enforce roles server-side: GET requests require any authenticated user, mutations require the ",(0,r.jsx)(n.code,{children:"admin"})," role"]}),"\n",(0,r.jsx)(n.li,{children:"The UI hides mutation controls (create, edit, delete buttons) for viewers"}),"\n",(0,r.jsx)(n.li,{children:"Role changes take effect on the user's next login (JWT maxAge is 1 hour)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"role-enforcement",children:"Role Enforcement"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Layer"}),(0,r.jsx)(n.th,{children:"Mechanism"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"API routes"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"requireAuth()"})," for read operations, ",(0,r.jsx)(n.code,{children:'requireRole("admin")'})," for mutations"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["Proxy (",(0,r.jsx)(n.code,{children:"proxy.ts"}),")"]}),(0,r.jsx)(n.td,{children:"JWT validation (Node.js runtime \u2014 checks token existence, not role)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"UI components"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"useRole()"})," hook conditionally renders admin-only controls"]})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"user-management",children:"User Management"}),"\n",(0,r.jsxs)(n.p,{children:["Administrators can manage users at ",(0,r.jsx)(n.strong,{children:"Admin \u2192 Users"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Create"})," users \u2014 local (username/password) or SSO-linked"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Edit"})," users \u2014 change display name, email, role, active status, or reset password"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Delete"})," users \u2014 with safeguards (cannot delete yourself, cannot delete the last admin)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Deactivate"})," users \u2014 toggle the active flag to disable login without deleting the account"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,r.jsx)(n.p,{children:"The only required environment variable for authentication is:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-env",children:"AUTH_SECRET=<openssl rand -base64 32>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["SSO provider credentials (Client ID, Client Secret, Tenant ID) are stored in the database and configured via the admin UI. They are ",(0,r.jsx)(n.strong,{children:"encrypted at rest"})," using AES-256-GCM with a key derived from ",(0,r.jsx)(n.code,{children:"AUTH_SECRET"}),"."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"login-audit-events",children:"Login Audit Events"}),"\n",(0,r.jsx)(n.p,{children:"Every sign-in attempt is recorded in the audit log with:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Action"}),": ",(0,r.jsx)(n.code,{children:"login"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Resource"}),": ",(0,r.jsx)(n.code,{children:"auth"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"User ID"}),": the authenticated username"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Details"}),": ",(0,r.jsx)(n.code,{children:'{ outcome: "success" | "denied" }'})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"IP address"}),": extracted from request headers"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"Audit-Logging",children:"Audit Logging"})," for more."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"dev-bypass-mode",children:"Dev Bypass Mode"}),"\n",(0,r.jsx)(n.p,{children:"For local development without creating user accounts, set:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-env",children:"AUTH_BYPASS_DEV=true\nNEXT_PUBLIC_AUTH_BYPASS_DEV=true\n"})}),"\n",(0,r.jsx)(n.p,{children:"In bypass mode:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"All authentication checks are skipped"}),"\n",(0,r.jsxs)(n.li,{children:["A mock session is injected with the user ",(0,r.jsx)(n.code,{children:"dev@localhost"})," and the ",(0,r.jsx)(n.code,{children:"admin"})," role"]}),"\n",(0,r.jsx)(n.li,{children:"The middleware passes all requests through without validation"}),"\n",(0,r.jsx)(n.li,{children:"No user accounts or SSO configuration are needed"}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Warning"}),": Dev bypass mode is only active when ",(0,r.jsx)(n.code,{children:"NODE_ENV=development"}),". It cannot be enabled in production builds."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"session-management",children:"Session Management"}),"\n",(0,r.jsx)(n.p,{children:"FileBridge uses JWT-based sessions with a 1-hour max age. Sessions are validated on every request via middleware. When a user's role is changed by an admin, the change takes effect when the user next logs in (or when the current JWT expires)."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"proxy",children:"Proxy"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"proxy.ts"})," intercepts every request (except public paths) and:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Generates or propagates a ",(0,r.jsx)(n.code,{children:"X-Request-ID"})," correlation UUID for log tracing"]}),"\n",(0,r.jsx)(n.li,{children:"Checks for a valid NextAuth JWT session"}),"\n",(0,r.jsxs)(n.li,{children:["Redirects unauthenticated requests to ",(0,r.jsx)(n.code,{children:"/login"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Public paths excluded from auth checks:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/"})," (root \u2014 handles first-run detection)"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"/login"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"/setup"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/api/auth/*"})," (NextAuth endpoints)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/api/setup/*"})," (setup wizard API)"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"/api/health"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453(e,n,s){s.d(n,{R:()=>l,x:()=>d});var i=s(6540);const r={},t=i.createContext(r);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);