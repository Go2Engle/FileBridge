"use strict";(self.webpackChunkfilebridge_docs=self.webpackChunkfilebridge_docs||[]).push([[381],{5554(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"Database-Backups","title":"Database Backups","description":"FileBridge includes a built-in backup system for the SQLite database. Backups can run on a schedule or be triggered manually from the Settings page.","source":"@site/../docs/Database-Backups.md","sourceDirName":".","slug":"/Database-Backups","permalink":"/FileBridge/docs/Database-Backups","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Hook Template Authoring","permalink":"/FileBridge/docs/Hook-Template-Authoring"},"next":{"title":"Health Check","permalink":"/FileBridge/docs/Health-Check"}}');var t=i(4848),r=i(8453);const a={},l="Database Backups",c={},d=[{value:"How Backups Work",id:"how-backups-work",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Backup File Naming",id:"backup-file-naming",level:2},{value:"Running a Backup",id:"running-a-backup",level:2},{value:"Scheduled",id:"scheduled",level:3},{value:"Manual",id:"manual",level:3},{value:"Listing Backups",id:"listing-backups",level:2},{value:"Retention",id:"retention",level:2},{value:"Restoring a Backup",id:"restoring-a-backup",level:2},{value:"In-App Restore (No Restart Required)",id:"in-app-restore-no-restart-required",level:3},{value:"Manual Restore (Alternative)",id:"manual-restore-alternative",level:3},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Docker / Volume Mounts",id:"docker--volume-mounts",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"database-backups",children:"Database Backups"})}),"\n",(0,t.jsx)(n.p,{children:"FileBridge includes a built-in backup system for the SQLite database. Backups can run on a schedule or be triggered manually from the Settings page."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"how-backups-work",children:"How Backups Work"}),"\n",(0,t.jsxs)(n.p,{children:["FileBridge uses ",(0,t.jsx)(n.code,{children:"better-sqlite3"}),"'s ",(0,t.jsx)(n.strong,{children:"online backup API"})," \u2014 the same mechanism SQLite uses internally for safe, consistent snapshots. This means:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Backups are taken while the database is live, with ",(0,t.jsx)(n.strong,{children:"no downtime"})]}),"\n",(0,t.jsx)(n.li,{children:"The backup is a complete, valid SQLite database file"}),"\n",(0,t.jsx)(n.li,{children:"A write lock is never held for the full duration \u2014 I/O is chunked to avoid blocking ongoing requests"}),"\n",(0,t.jsxs)(n.li,{children:["Every backup is verified with ",(0,t.jsx)(n.code,{children:"PRAGMA integrity_check"})," before being saved"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"If the integrity check fails, the backup file is deleted and an error is thrown. You will never have a corrupt backup silently sitting in the backup directory."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["Backup settings are configured at ",(0,t.jsx)(n.strong,{children:"Settings \u2192 Database Backups"})," in the UI, or directly via the ",(0,t.jsx)(n.code,{children:"POST /api/settings"})," API."]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Setting"}),(0,t.jsx)(n.th,{children:"Default"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Enable scheduled backups"})}),(0,t.jsx)(n.td,{children:"Off"}),(0,t.jsx)(n.td,{children:"Toggle the automatic backup cron job"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Schedule"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0 2 * * *"})}),(0,t.jsx)(n.td,{children:"Cron expression for when backups run (default: 2:00 AM daily)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Local backup path"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"<cwd>/data/backups"})}),(0,t.jsxs)(n.td,{children:["Directory where backup ",(0,t.jsx)(n.code,{children:".db"})," files are stored"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Retention count"})}),(0,t.jsx)(n.td,{children:"7"}),(0,t.jsx)(n.td,{children:"Number of backups to keep \u2014 oldest are pruned automatically"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["Settings are persisted in the ",(0,t.jsx)(n.code,{children:"settings"})," table under the key ",(0,t.jsx)(n.code,{children:'"backup"'}),"."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"backup-file-naming",children:"Backup File Naming"}),"\n",(0,t.jsx)(n.p,{children:"Backup files follow this format:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"filebridge-2026-02-22T02-00-00-000Z.db\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The timestamp is the ISO 8601 UTC time with ",(0,t.jsx)(n.code,{children:":"})," and ",(0,t.jsx)(n.code,{children:"."})," replaced by ",(0,t.jsx)(n.code,{children:"-"})," to ensure safe filenames on all platforms. Files are lexicographically sortable (oldest first), which the retention pruning relies on."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"running-a-backup",children:"Running a Backup"}),"\n",(0,t.jsx)(n.h3,{id:"scheduled",children:"Scheduled"}),"\n",(0,t.jsxs)(n.p,{children:["Enable automatic backups in ",(0,t.jsx)(n.strong,{children:"Settings \u2192 Database Backups"})," and set a cron schedule. The backup scheduler is initialized at startup alongside the job scheduler. When you save new backup settings, the scheduler is re-initialized immediately \u2014 no restart required."]}),"\n",(0,t.jsx)(n.h3,{id:"manual",children:"Manual"}),"\n",(0,t.jsxs)(n.p,{children:["Click ",(0,t.jsx)(n.strong,{children:"Backup Now"})," on the Settings page, or call:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"POST /api/backup/run\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "filename": "filebridge-2026-02-22T10-15-30-000Z.db",\n  "path": "/app/data/backups/filebridge-2026-02-22T10-15-30-000Z.db",\n  "sizeBytes": 204800,\n  "createdAt": "2026-02-22T10:15:30.000Z",\n  "integrity": "ok"\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"listing-backups",children:"Listing Backups"}),"\n",(0,t.jsx)(n.p,{children:"The Settings page displays all available backups with their filename, size, and creation time."}),"\n",(0,t.jsx)(n.p,{children:"Via API:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"GET /api/backup/list\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"retention",children:"Retention"}),"\n",(0,t.jsxs)(n.p,{children:["After each backup, the system prunes old backups if the total count exceeds the configured retention count. The oldest files (by filename sort order) are deleted first. The currently created backup does ",(0,t.jsx)(n.strong,{children:"not"})," count against the retention limit until the next run."]}),"\n",(0,t.jsxs)(n.p,{children:["Example: With ",(0,t.jsx)(n.code,{children:"retentionCount = 7"}),", after the 8th backup runs, the oldest backup is deleted, leaving exactly 7."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"restoring-a-backup",children:"Restoring a Backup"}),"\n",(0,t.jsx)(n.h3,{id:"in-app-restore-no-restart-required",children:"In-App Restore (No Restart Required)"}),"\n",(0,t.jsxs)(n.p,{children:["FileBridge supports live restore using SQLite's ",(0,t.jsx)(n.code,{children:"ATTACH DATABASE"})," mechanism:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Go to ",(0,t.jsx)(n.strong,{children:"Settings \u2192 Database Backups"})]}),"\n",(0,t.jsx)(n.li,{children:"Find the backup you want to restore"}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Restore"})]}),"\n",(0,t.jsx)(n.li,{children:"Confirm the operation"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The restore process:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Verifies the backup file's integrity (",(0,t.jsx)(n.code,{children:"PRAGMA integrity_check"}),") \u2014 aborts if corrupt"]}),"\n",(0,t.jsxs)(n.li,{children:["Creates a ",(0,t.jsx)(n.strong,{children:"pre-restore safety backup"})," of the current database"]}),"\n",(0,t.jsx)(n.li,{children:"Attaches the backup file as a secondary database"}),"\n",(0,t.jsxs)(n.li,{children:["Wraps all table replacements in a single SQLite transaction:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Deletes all rows from each table (",(0,t.jsx)(n.code,{children:"connections"}),", ",(0,t.jsx)(n.code,{children:"jobs"}),", ",(0,t.jsx)(n.code,{children:"job_runs"}),", ",(0,t.jsx)(n.code,{children:"transfer_logs"}),", ",(0,t.jsx)(n.code,{children:"settings"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"Re-inserts all rows from the backup"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Detaches the backup database"}),"\n",(0,t.jsx)(n.li,{children:"Foreign key checks are disabled during the transaction and re-enabled after"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Tables are restored in dependency-safe order to avoid FK constraint violations."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Warning"}),": Any in-flight web requests during the restore window may see inconsistent data. For production environments with active traffic, schedule restores during low-activity windows."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"manual-restore-alternative",children:"Manual Restore (Alternative)"}),"\n",(0,t.jsx)(n.p,{children:"If the in-app restore is not suitable, you can restore manually:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Stop the FileBridge process"}),"\n",(0,t.jsxs)(n.li,{children:["Replace ",(0,t.jsx)(n.code,{children:"data/filebridge.db"})," with the desired backup ",(0,t.jsx)(n.code,{children:".db"})," file:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cp data/backups/filebridge-2026-02-22T02-00-00-000Z.db data/filebridge.db\n"})}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Restart the process"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Every backup file is a fully valid, standalone SQLite database. No import step is needed."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The restore endpoint validates that the requested filename does not escape the backup directory (path traversal protection)"}),"\n",(0,t.jsx)(n.li,{children:"Backup files contain the full database including all job configurations and settings \u2014 secure the backup directory appropriately"}),"\n",(0,t.jsxs)(n.li,{children:["Credentials stored in ",(0,t.jsx)(n.code,{children:"connections.credentials"})," are included in backups. Until field-level encryption is implemented, treat backup files as sensitive"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"docker--volume-mounts",children:"Docker / Volume Mounts"}),"\n",(0,t.jsx)(n.p,{children:"In a Docker deployment, ensure your backup directory is on a persistent volume separate from the main database:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"volumes:\n  - filebridge-data:/app/data        # main database\n  - filebridge-backups:/app/backups  # backup files\n"})}),"\n",(0,t.jsx)(n.p,{children:"Or use a single volume with subdirectories and set:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-env",children:"DATABASE_PATH=/app/data/filebridge.db\n# Backup path configured in Settings UI: /app/data/backups\n"})}),"\n",(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.a,{href:"Docker-Deployment",children:"Docker Deployment"})," for full container configuration."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},8453(e,n,i){i.d(n,{R:()=>a,x:()=>l});var s=i(6540);const t={},r=s.createContext(t);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);