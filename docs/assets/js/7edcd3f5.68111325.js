"use strict";(self.webpackChunkfilebridge_docs=self.webpackChunkfilebridge_docs||[]).push([[288],{5745(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"Health-Check","title":"Health Check","description":"FileBridge exposes a health check endpoint at GET /api/health for use with container orchestration systems (Kubernetes, ECS, Docker Swarm) and uptime monitoring tools.","source":"@site/../docs/Health-Check.md","sourceDirName":".","slug":"/Health-Check","permalink":"/FileBridge/docs/Health-Check","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Database Backups","permalink":"/FileBridge/docs/Database-Backups"},"next":{"title":"Audit Logging","permalink":"/FileBridge/docs/Audit-Logging"}}');var i=s(4848),t=s(8453);const d={},l="Health Check",o={},c=[{value:"Endpoint",id:"endpoint",level:2},{value:"Response",id:"response",level:2},{value:"Healthy (HTTP 200)",id:"healthy-http-200",level:3},{value:"Degraded (HTTP 503)",id:"degraded-http-503",level:3},{value:"Response Fields",id:"response-fields",level:2},{value:"Checks Performed",id:"checks-performed",level:2},{value:"Database",id:"database",level:3},{value:"Scheduler",id:"scheduler",level:3},{value:"Kubernetes Configuration",id:"kubernetes-configuration",level:2},{value:"Liveness Probe",id:"liveness-probe",level:3},{value:"Readiness Probe",id:"readiness-probe",level:3},{value:"Full Deployment Example",id:"full-deployment-example",level:3},{value:"Docker Compose HEALTHCHECK",id:"docker-compose-healthcheck",level:2},{value:"External Monitoring",id:"external-monitoring",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"health-check",children:"Health Check"})}),"\n",(0,i.jsxs)(n.p,{children:["FileBridge exposes a health check endpoint at ",(0,i.jsx)(n.code,{children:"GET /api/health"})," for use with container orchestration systems (Kubernetes, ECS, Docker Swarm) and uptime monitoring tools."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"endpoint",children:"Endpoint"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"GET /api/health\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Authentication"}),": None required \u2014 this is a public endpoint. This is necessary so Kubernetes liveness and readiness probes can check health without needing to manage session cookies or tokens."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"response",children:"Response"}),"\n",(0,i.jsx)(n.h3,{id:"healthy-http-200",children:"Healthy (HTTP 200)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "status": "ok",\n  "version": "0.1.0",\n  "uptime": 3600,\n  "checks": {\n    "database": { "status": "ok" },\n    "scheduler": { "status": "ok", "scheduledJobs": 6 }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"degraded-http-503",children:"Degraded (HTTP 503)"}),"\n",(0,i.jsx)(n.p,{children:"Returned when one or more checks fail:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "status": "degraded",\n  "version": "0.1.0",\n  "uptime": 3600,\n  "checks": {\n    "database": { "status": "error", "error": "SQLITE_IOERR: disk I/O error" },\n    "scheduler": { "status": "ok", "scheduledJobs": 0 }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"response-fields",children:"Response Fields"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"status"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:'"ok"'})," if all checks pass, ",(0,i.jsx)(n.code,{children:'"degraded"'})," if any check fails"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"version"})}),(0,i.jsxs)(n.td,{children:["Application version from ",(0,i.jsx)(n.code,{children:"package.json"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"uptime"})}),(0,i.jsx)(n.td,{children:"Process uptime in seconds"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"checks.database.status"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:'"ok"'})," or ",(0,i.jsx)(n.code,{children:'"error"'})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"checks.database.error"})}),(0,i.jsxs)(n.td,{children:["Error message when status is ",(0,i.jsx)(n.code,{children:'"error"'})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"checks.scheduler.status"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:'"ok"'})," or ",(0,i.jsx)(n.code,{children:'"error"'})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"checks.scheduler.scheduledJobs"})}),(0,i.jsx)(n.td,{children:"Number of active cron jobs registered in the scheduler"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"checks-performed",children:"Checks Performed"}),"\n",(0,i.jsx)(n.h3,{id:"database",children:"Database"}),"\n",(0,i.jsxs)(n.p,{children:["Executes ",(0,i.jsx)(n.code,{children:"SELECT 1"})," via Drizzle ORM to verify the SQLite connection is live and the database file is accessible. Fails if the file is locked, corrupt, or the disk is unavailable."]}),"\n",(0,i.jsx)(n.h3,{id:"scheduler",children:"Scheduler"}),"\n",(0,i.jsxs)(n.p,{children:["Calls ",(0,i.jsx)(n.code,{children:"getScheduledJobIds()"})," to verify the scheduler module is loaded and accessible. Returns the count of currently registered cron tasks. Note: 0 scheduled jobs is not itself an error \u2014 it means no jobs are currently set to ",(0,i.jsx)(n.code,{children:"active"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"kubernetes-configuration",children:"Kubernetes Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"liveness-probe",children:"Liveness Probe"}),"\n",(0,i.jsx)(n.p,{children:"A liveness probe restarts the container if the app becomes unresponsive (e.g. deadlocked):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"livenessProbe:\n  httpGet:\n    path: /api/health\n    port: 3000\n  initialDelaySeconds: 15\n  periodSeconds: 30\n  timeoutSeconds: 5\n  failureThreshold: 3\n"})}),"\n",(0,i.jsx)(n.h3,{id:"readiness-probe",children:"Readiness Probe"}),"\n",(0,i.jsx)(n.p,{children:"A readiness probe removes the pod from load balancer rotation if the app is not ready to serve traffic:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"readinessProbe:\n  httpGet:\n    path: /api/health\n    port: 3000\n  initialDelaySeconds: 5\n  periodSeconds: 10\n  timeoutSeconds: 3\n  failureThreshold: 3\n"})}),"\n",(0,i.jsx)(n.h3,{id:"full-deployment-example",children:"Full Deployment Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: filebridge\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: filebridge\n  template:\n    metadata:\n      labels:\n        app: filebridge\n    spec:\n      containers:\n        - name: filebridge\n          image: your-registry/filebridge:latest\n          ports:\n            - containerPort: 3000\n          env:\n            - name: NODE_OPTIONS\n              value: "--openssl-legacy-provider"\n          envFrom:\n            - secretRef:\n                name: filebridge-secrets\n          volumeMounts:\n            - name: data\n              mountPath: /app/data\n          livenessProbe:\n            httpGet:\n              path: /api/health\n              port: 3000\n            initialDelaySeconds: 15\n            periodSeconds: 30\n            timeoutSeconds: 5\n            failureThreshold: 3\n          readinessProbe:\n            httpGet:\n              path: /api/health\n              port: 3000\n            initialDelaySeconds: 5\n            periodSeconds: 10\n            timeoutSeconds: 3\n            failureThreshold: 3\n      volumes:\n        - name: data\n          persistentVolumeClaim:\n            claimName: filebridge-data-pvc\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"docker-compose-healthcheck",children:"Docker Compose HEALTHCHECK"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'services:\n  filebridge:\n    image: filebridge:latest\n    healthcheck:\n      test: ["CMD", "curl", "-f", "http://localhost:3000/api/health"]\n      interval: 30s\n      timeout: 5s\n      retries: 3\n      start_period: 15s\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"external-monitoring",children:"External Monitoring"}),"\n",(0,i.jsxs)(n.p,{children:["You can poll ",(0,i.jsx)(n.code,{children:"/api/health"})," from any uptime monitoring tool (UptimeRobot, Pingdom, Datadog Synthetics, etc.):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Monitor URL: ",(0,i.jsx)(n.code,{children:"https://your-domain.com/api/health"})]}),"\n",(0,i.jsxs)(n.li,{children:["Expected status code: ",(0,i.jsx)(n.code,{children:"200"})]}),"\n",(0,i.jsxs)(n.li,{children:["Optional content check: ",(0,i.jsx)(n.code,{children:'"status":"ok"'})]}),"\n",(0,i.jsx)(n.li,{children:"Check interval: 30\u201360 seconds recommended"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453(e,n,s){s.d(n,{R:()=>d,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function d(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);